<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Online Tic Tac Toe</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<style>
body {
  margin: 0;
  font-family: "Segoe UI", sans-serif;
  background: linear-gradient(135deg, #667eea, #764ba2);
  color: white;
  text-align: center;
}

h1 { margin-top: 16px; }

.controls {
  margin: 15px;
}

input, select, button {
  padding: 10px;
  margin: 6px;
  border-radius: 8px;
  border: none;
}

button {
  cursor: pointer;
  background: #00e676;
  font-weight: bold;
}

.board {
  display: grid;
  gap: 10px;
  justify-content: center;
  margin-top: 20px;
}

.cell {
  width: min(22vw, 80px);
  height: min(22vw, 80px);
  font-size: 2rem;
  background: white;
  color: black;
  border-radius: 12px;
}

.highlight {
  background: gold !important;
}

.info {
  margin-top: 10px;
  font-size: 18px;
}

footer {
  margin-top: 30px;
  font-size: 14px;
  opacity: 0.8;
}
</style>
</head>

<body>

<h1>Online Tic Tac Toe</h1>

<div class="controls">
  <input id="username" placeholder="Your Name" />
  <input id="room" placeholder="Room Code" />
  <select id="size">
    <option value="3">3 √ó 3</option>
    <option value="4">4 √ó 4</option>
  </select>
  <label>
    <input type="checkbox" id="aiToggle" /> Play vs AI
  </label>
  <br />
  <button onclick="join()">Join Game</button>
  <button onclick="resetGame()">Reset</button>
</div>

<div class="info" id="status">Not connected</div>
<div class="info" id="timer">‚è± Timer: --</div>

<div id="board" class="board"></div>

<footer>
  Created by <b>Shivnath Pradhan</b>
</footer>

<script>
let ws;
let gridSize = 3;
let playerId = null;

function join() {
  const room = document.getElementById("room").value;
  const name = document.getElementById("username").value || "Player";
  gridSize = Number(document.getElementById("size").value);
  const ai = document.getElementById("aiToggle").checked;

  if (!room) {
    alert("Enter room code");
    return;
  }

  ws = new WebSocket(
    "wss://tic-tac-toe-backend-5.onrender.com/ws/" + room
  );

  ws.onopen = () => {
    ws.send(JSON.stringify({
      type: "join",
      name,
      grid: gridSize,
      timer: 15,
      ai
    }));
    document.getElementById("status").innerText = "Connected ‚úî";
  };

  ws.onmessage = (e) => {
    const data = JSON.parse(e.data);

    if (playerId === null && data.names) {
      playerId = data.names.indexOf(name);
    }

    renderBoard(data.board, data.win_line);

    document.getElementById("timer").innerText =
      `‚è± Timer: ${data.time_left}s`;

    if (data.winner !== null) {
      document.getElementById("status").innerText =
        data.winner === "Draw"
          ? "Game Draw ü§ù"
          : `Winner: ${data.names[data.winner]} üéâ`;
    } else {
      document.getElementById("status").innerText =
        data.turn === playerId
          ? "Your Turn üéØ"
          : `Opponent's Turn (${data.names[data.turn]})`;
    }
  };

  ws.onerror = () => {
    document.getElementById("status").innerText = "Connection Error ‚ùå";
  };
}

function renderBoard(board, winLine) {
  const b = document.getElementById("board");
  b.innerHTML = "";
  b.style.gridTemplateColumns = `repeat(${gridSize}, 1fr)`;

  board.forEach((cell, i) => {
    const btn = document.createElement("button");
    btn.className = "cell";

    if (cell === 0) btn.innerText = "X";
    if (cell === 1) btn.innerText = "O";

    if (winLine && winLine.includes(i)) {
      btn.classList.add("highlight");
    }

    btn.onclick = () => {
      ws.send(JSON.stringify({
        type: "move",
        index: i
      }));
    };

    b.appendChild(btn);
  });
}

function resetGame() {
  ws.send(JSON.stringify({ type: "reset" }));
}
</script>

</body>
</html>
